{-# LANGUAGE LambdaCase        #-}
{-# LANGUAGE OverloadedStrings #-}
{-# LANGUAGE RecordWildCards #-}

module Main where

import Control.Monad
import Data.Either (isRight)
import Servant.API.EventStream
import Test.Hspec
import qualified Data.Attoparsec.ByteString.Char8 as A
import qualified Data.ByteString as B
import qualified Data.ByteString.Char8 as C8
import qualified Data.Text as T
import qualified Network.Wai.EventSource.EventStream as Wai

newtype TestServerEvent = TestServerEvent { _TestServerEvent :: Wai.ServerEvent }

instance Show TestServerEvent where
  show = T.unpack . renderServerEvent . _TestServerEvent

instance Eq TestServerEvent where
  (TestServerEvent s1) == (TestServerEvent s2) = case (s1, s2) of
    (Wai.ServerEvent en1 eid1 edt1, Wai.ServerEvent en2 eid2 edt2)
      -> fmap builderToText en1  == fmap builderToText en2  &&
         fmap builderToText eid1 == fmap builderToText eid2 &&
         map builderToText edt1  == map builderToText edt2
    (Wai.ServerEvent{}, _)                         -> False
    (Wai.CommentEvent cmt1, Wai.CommentEvent cmt2) -> builderToText cmt1 == builderToText cmt2
    (Wai.CommentEvent _, _)                        -> False
    (Wai.RetryEvent r1, Wai.RetryEvent r2)         -> r1 == r2
    (Wai.RetryEvent _, _)                          -> False
    (Wai.CloseEvent, Wai.CloseEvent)               -> True
    (Wai.CloseEvent, _)                            -> False

parseTestServerEvent :: B.ByteString -> Either String TestServerEvent
parseTestServerEvent = fmap TestServerEvent . A.parseOnly serverEventParser

main :: IO ()
main = hspec $
  describe "EventStream parsing" $ do
    forM_ (zip [1..] testVectors) $ \(idx, tv) ->
      it ("can parse test vector #" <> show idx) $ testParseEventStream tv
    it "supports multiple `data:` frames" testMultipleFrame

testParseEventStream :: B.ByteString -> Expectation
testParseEventStream bs =
  parseTestServerEvent bs `shouldSatisfy` isRight

testMultipleFrame :: Expectation
testMultipleFrame =
  parseTestServerEvent bs `shouldSatisfy` \case
    Left _err -> False
    Right se  -> case se of
      (TestServerEvent Wai.ServerEvent{..}) -> length eventData == 7
      _                                     -> False
  where
    bs = "data: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"role\":\"assistant\",\"function_call\":{\"name\":\"answer_form_question\"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\"{\\n\"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\" \"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\" \\\"\"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\"653\"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\"b\"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\"675\"}},\"content_filter_results\":{}}],\"usage\":null}\n\n"

testVectors :: [B.ByteString]
testVectors = map C8.pack [
    "data: {\"id\":\"\",\"object\":\"\",\"created\":0,\"model\":\"\",\"prompt_filter_results\":[{\"prompt_index\":0,\"content_filter_results\":{\"hate\":{\"filtered\":false,\"severity\":\"safe\"},\"self_harm\":{\"filtered\":false,\"severity\":\"safe\"},\"sexual\":{\"filtered\":false,\"severity\":\"safe\"},\"violence\":{\"filtered\":false,\"severity\":\"safe\"}}}],\"choices\":[],\"usage\":null}\n\n"
  , "data: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"role\":\"assistant\",\"function_call\":{\"name\":\"answer_form_question\"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\"{\\n\"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\" \"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\" \\\"\"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\"653\"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\"b\"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\"675\"}},\"content_filter_results\":{}}],\"usage\":null}\n\n"
  , "data: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\"d\"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\"951\"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\"654\"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\"68\"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\"d\"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\"14\"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\"e\"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\"003\"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\"3\"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\"\\\":\"}},\"content_filter_results\":{}}],\"usage\":null}\n\n"
  , "data: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\" {\\n\"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\"   \"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\" \\\"\"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\"name\"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\"\\\":\"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\" \\\"\"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\"653\"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\"b\"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\"675\"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\"d\"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\"951\"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\"654\"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\"68\"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\"d\"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\"14\"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\"e\"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\"003\"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\"3\"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\"\\\",\\n\"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\"   \"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\" \\\"\"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\"value\"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\"\\\":\"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\" \\\"\"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\"F\"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\"ender\"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\" Japan\"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\" K\"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\"ink\"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\"o\"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\"model\":\"gpt-4-32k\",\"choices\":[{\"index\":0,\"finish_reason\":null,\"delta\":{\"function_call\":{\"arguments\":\"'s\"}},\"content_filter_results\":{}}],\"usage\":null}\n\ndata: {\"id\":\"chatcmpl-8G3En67TAieEHslWbMbj2hyBVksUa\",\"object\":\"chat.completion.chunk\",\"created\":1698836385,\""
  ]
